<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Video Player</title>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    html, body { width: 100%; height: 100%; background: #0a0a0a; }
    
    #player-container {
      width: 100%;
      height: 100%;
      position: relative;
      background: #000;
    }
    
    #video-element {
      width: 100%;
      height: 100%;
      display: block;
    }
    
    /* Simple always-visible controls */
    #controls {
      position: absolute;
      bottom: 0;
      left: 0;
      right: 0;
      background: rgba(20, 20, 20, 0.95);
      padding: 10px 15px;
      border-top: 1px solid #333;
      display: flex;
      align-items: center;
      gap: 12px;
    }
    
    .btn {
      background: #2a2a2a;
      border: 1px solid #444;
      color: #fff;
      width: 36px;
      height: 36px;
      border-radius: 6px;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 16px;
      transition: background 0.15s, border-color 0.15s;
    }
    
    .btn:hover {
      background: #3a3a3a;
      border-color: #555;
    }
    
    .btn:active {
      background: #1a1a1a;
    }
    
    #progress-container {
      flex: 1;
      height: 4px;
      background: #333;
      border-radius: 2px;
      cursor: pointer;
      position: relative;
    }
    
    #progress-bar {
      height: 100%;
      background: #3b82f6;
      border-radius: 2px;
      width: 0%;
    }
    
    #time {
      color: #ccc;
      font-size: 13px;
      font-family: monospace;
      min-width: 90px;
      text-align: center;
    }
    
    /* Volume control - simplified */
    #volume-btn {
      width: 36px;
      position: relative;
    }
    
    /* Open in App button - subtle */
    #open-in-app {
      position: absolute;
      top: 12px;
      right: 12px;
      background: rgba(30, 30, 30, 0.85);
      color: #ccc;
      padding: 6px 12px;
      border-radius: 4px;
      text-decoration: none;
      font-size: 12px;
      font-family: -apple-system, BlinkMacSystemFont, sans-serif;
      border: 1px solid #444;
      transition: background 0.15s, color 0.15s;
      backdrop-filter: blur(4px);
    }
    
    #open-in-app:hover {
      background: rgba(40, 40, 40, 0.95);
      color: #fff;
      border-color: #555;
    }
    
    /* Loading */
    #loading {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      color: #aaa;
      font-size: 13px;
      font-family: sans-serif;
    }
    
    /* Hide native controls */
    #video-element::-webkit-media-controls {
      display: none !important;
    }
  </style>
</head>
<body>
  <div id="player-container">
    <!-- Open in App button -->
    <a id="open-in-app" href="#" target="_blank" style="display: none;">
      Open in App â†’
    </a>
    
    <!-- Video element -->
    <video id="video-element" playsinline></video>
    
    <!-- Loading -->
    <div id="loading">Loading...</div>
    
    <!-- Controls -->
    <div id="controls">
      <button id="play-pause" class="btn">â–¶</button>
      <div id="progress-container">
        <div id="progress-bar"></div>
      </div>
      <div id="time">0:00 / 0:00</div>
      <button id="volume-btn" class="btn">ðŸ”Š</button>
      <button id="fullscreen-btn" class="btn">â¤¢</button>
    </div>
  </div>

  <script>
    // Get URL parameters
    const urlParams = new URLSearchParams(window.location.search);
    const videoUrl = urlParams.get('v');
    const eventId = urlParams.get('id');
    const authorPubkey = urlParams.get('author');
    
    // DOM elements
    const video = document.getElementById('video-element');
    const playPauseBtn = document.getElementById('play-pause');
    const progressBar = document.getElementById('progress-bar');
    const progressContainer = document.getElementById('progress-container');
    const timeDisplay = document.getElementById('time');
    const volumeBtn = document.getElementById('volume-btn');
    const fullscreenBtn = document.getElementById('fullscreen-btn');
    const loading = document.getElementById('loading');
    const openInApp = document.getElementById('open-in-app');
    const playerContainer = document.getElementById('player-container');
    
    // Format time helper
    function formatTime(seconds) {
      if (isNaN(seconds)) return '0:00';
      const mins = Math.floor(seconds / 60);
      const secs = Math.floor(seconds % 60);
      return `${mins}:${secs.toString().padStart(2, '0')}`;
    }
    
    // Update progress
    function updateProgress() {
      if (video.duration) {
        const progress = (video.currentTime / video.duration) * 100;
        progressBar.style.width = `${progress}%`;
        timeDisplay.textContent = `${formatTime(video.currentTime)} / ${formatTime(video.duration)}`;
      }
    }
    
    // Seek on progress bar click
    progressContainer.addEventListener('click', (e) => {
      const rect = progressContainer.getBoundingClientRect();
      const percent = (e.clientX - rect.left) / rect.width;
      video.currentTime = percent * video.duration;
    });
    
    // Play/Pause
    playPauseBtn.addEventListener('click', () => {
      if (video.paused) {
        video.play().catch(() => {
          playPauseBtn.textContent = 'â–¶';
        });
        playPauseBtn.textContent = 'â¸';
      } else {
        video.pause();
        playPauseBtn.textContent = 'â–¶';
      }
    });
    
    // Video events
    video.addEventListener('play', () => {
      playPauseBtn.textContent = 'â¸';
      loading.style.display = 'none';
    });
    
    video.addEventListener('pause', () => {
      playPauseBtn.textContent = 'â–¶';
    });
    
    video.addEventListener('timeupdate', updateProgress);
    
    video.addEventListener('loadeddata', () => {
      loading.style.display = 'none';
      updateProgress();
    });
    
    video.addEventListener('waiting', () => {
      loading.style.display = 'block';
    });
    
    video.addEventListener('canplay', () => {
      loading.style.display = 'none';
    });
    
    // Volume toggle (simple mute/unmute)
    let isMuted = false;
    volumeBtn.addEventListener('click', () => {
      video.muted = !video.muted;
      isMuted = video.muted;
      volumeBtn.textContent = isMuted ? 'ðŸ”‡' : 'ðŸ”Š';
    });
    
    // Fullscreen
    fullscreenBtn.addEventListener('click', () => {
      if (!document.fullscreenElement) {
        playerContainer.requestFullscreen();
        fullscreenBtn.textContent = 'â¤¡';
      } else {
        document.exitFullscreen();
        fullscreenBtn.textContent = 'â¤¢';
      }
    });
    
    // Initialize
    if (videoUrl) {
      // Set up "Open in App" link
      if (eventId && authorPubkey) {
        const appUrl = `http://vutr.space/#watch/params?v=${eventId}&author=${authorPubkey}`;
        openInApp.href = appUrl;
        openInApp.style.display = 'block';
      }
      
      // Load video
      video.src = decodeURIComponent(videoUrl);
      video.load();
      
      // Try autoplay
      video.play().catch(() => {
        // Autoplay blocked, show play button
        playPauseBtn.textContent = 'â–¶';
      });
      
      // Default volume
      video.volume = 0.8;
      video.muted = false;
      
    } else {
      loading.textContent = 'No video URL provided';
      loading.style.color = '#ef4444';
    }
    
    // Simple keyboard controls
    document.addEventListener('keydown', (e) => {
      switch(e.key) {
        case ' ':
        case 'k':
          e.preventDefault();
          video.paused ? video.play() : video.pause();
          break;
        case 'f':
          playerContainer.requestFullscreen();
          break;
        case 'm':
          video.muted = !video.muted;
          volumeBtn.textContent = video.muted ? 'ðŸ”‡' : 'ðŸ”Š';
          break;
        case 'ArrowLeft':
          video.currentTime = Math.max(0, video.currentTime - 5);
          break;
        case 'ArrowRight':
          video.currentTime = Math.min(video.duration, video.currentTime + 5);
          break;
      }
    });
    
    // Click video to play/pause
    video.addEventListener('click', () => {
      video.paused ? video.play() : video.pause();
    });
  </script>
</body>
</html>